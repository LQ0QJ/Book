{% extends "layouts/index.html" %}

{% block title %}Torrents{% endblock %}

{% block body %}
  {% if gettext('common.english_only') != 'Text below continues in English.' %}
    <p class="mb-4 font-bold">{{ gettext('common.english_only') }}</p>
  {% endif %}

  <div lang="en">
    <h2 class="mt-4 mb-1 text-3xl font-bold">Torrents</h2>

    <p class="mb-4">
      These are all the torrents currently managed and released by Anna’s Archive. For more information, see “Our projects” on the <a href="/datasets">Datasets</a> page. For Library Genesis and Sci-Hub torrents, the <a href="https://libgen.li/torrents/">Libgen.li torrents page</a> maintains an overview.
    </p>

    <p class="mb-4">
      These torrents are not meant for downloading individual books. They are meant for long-term preservation. With these torrents you can set up a full mirror of Anna’s Archive, using our <a href="https://annas-software.org/AnnaArchivist/annas-archive">source code</a>.
    </p>

    <p class="mb-4">
      Torrents with “aac” in the filename use the <a href="https://annas-blog.org/annas-archive-containers.html">Anna’s Archive Containers format</a>. Torrents that are crossed out have been superseded by newer torrents, for example because newer metadata has become available — we normally only do this with small metadata torrents. Some torrents that have messages in their filename are “adopted torrents”, which is a perk of our top tier <a href="/donate">“Amazing Archivist” membership</a>.
    </p>

    <p class="mb-1">
      You can help out enormously by seeding torrents that are low on seeders. If everyone who reads this chips in, we can preserve these collections forever. This is the current breakdown:
    </p>

    <table class="mb-2">
      <tr><td>🔴 {{ torrents_data.seeder_counts[0] }} torrent{% if torrents_data.seeder_counts[0] != 1 %}s{% endif %}</td><td class="pl-4">{{ torrents_data.seeder_size_strings[0] }}</td><td class="text-sm text-gray-500 pl-4">&lt;4 seeders</td></tr>
      <tr><td>🟡 {{ torrents_data.seeder_counts[1] }} torrent{% if torrents_data.seeder_counts[1] != 1 %}s{% endif %}</td><td class="pl-4">{{ torrents_data.seeder_size_strings[1] }}</td><td class="text-sm text-gray-500 pl-4">4–10 seeders</td></tr>
      <tr><td>🟢 {{ torrents_data.seeder_counts[2] }} torrent{% if torrents_data.seeder_counts[2] != 1 %}s{% endif %}</td><td class="pl-4">{{ torrents_data.seeder_size_strings[2] }}</td><td class="text-sm text-gray-500 pl-4">&gt;10 seeders</td></tr>
      <tr><td colspan="100" class="text-xs text-gray-500">Counts scraped from <a href="https://opentrackr.org">opentrackr.org</a>.</td></tr>
    </table>

    <p class="mb-1">
      <strong>IMPORTANT:</strong> If you seed large amounts of our collection (50TB or more), please contact us at <a class="" href="mailto:AnnaArchivist@proton.me">AnnaArchivist@proton.me</a> so we can let you know when we deprecate any large torrents.
    </p>

    <div class="overflow-hidden max-w-full">
      <table>
        {% for group, small_files in torrents_data.small_file_dicts_grouped.items() %}
          <tr><td colspan="100" class="pt-4"><span class="text-xl font-bold" id="{{ group | replace('/', '__') }}">{{ group }}</span> <span class="text-xs text-gray-500">{{ torrents_data.group_size_strings[group] }}</span> <a href="#{{ group | replace('/', '__') }}" class="custom-a invisible [td:hover>&]:visible text-gray-400 hover:text-gray-500 text-sm align-[2px]">§</a>

            {% if group == 'libgenli_comics' %}
              <div class="mb-1 text-sm">Comics and magazines from Libgen.li. <a href="/datasets/libgen_li">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://annas-blog.org/backed-up-the-worlds-largest-comics-shadow-lib.html">blog</a></div>
            {% elif group == 'zlib' %}
              <div class="mb-1 text-sm">Z-Library books. <a href="/datasets/zlib">dataset</a></div>
            {% elif group == 'isbndb' %}
              <div class="mb-1 text-sm">ISBNdb metadata. <a href="/datasets/isbndb">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://annas-blog.org/blog-isbndb-dump-how-many-books-are-preserved-forever.html">blog</a></div>
            {% elif group == 'libgenrs_covers' %}
              <div class="mb-1 text-sm">Book covers from Libgen.rs. <a href="/datasets/libgen_rs">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://annas-blog.org/annas-update-open-source-elasticsearch-covers.html">blog</a></div>
            {% elif group == 'ia' %}
              <div class="mb-1 text-sm">Internet Archive Controlled Digital Lending books and magazines. <a href="/datasets/ia">dataset</a></div>
            {% elif group == 'worldcat' %}
              <div class="mb-1 text-sm">Metadata from OCLC/Worldcat. <a href="/datasets/worldcat">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://annas-blog.org/worldcat-scrape.html">blog</a></div>
            {% endif %}
          </td></tr>

          {% for small_file in small_files %}
            <tr class="{% if small_file.file_path in torrents_data.obsolete_file_paths %}line-through{% endif %}">
              <td class="pb-1 max-md:break-all"><a href="/small_file/{{ small_file.file_path }}">{{ small_file.file_path_short }}</a><a class="ml-2 text-sm whitespace-nowrap" href="magnet:?xt=urn:btih:{{ small_file.metadata.btih }}&dn={{ small_file.display_name | urlencode }}&tr=udp://tracker.opentrackr.org:1337/announce">magnet</a></td>
              <td class="text-sm pb-1 pl-2 md:whitespace-nowrap">{{ small_file.created | datetimeformat('yyyy-MM-dd') }}</td>
              <td class="text-sm pb-1 pl-2 whitespace-nowrap">{{ small_file.size_string }}</td>
              <td class="text-sm pb-1 pl-2 whitespace-nowrap max-md:hidden">{% if small_file.is_metadata %}metadata{% else %}data{% endif %}</td>
              <td class="text-sm pb-1 pl-2 pr-2 lg:whitespace-nowrap">{% if small_file.scrape_metadata.scrape %}<span class="text-[10px] leading-none align-[2px]">{% if small_file.scrape_metadata.scrape.seeders < 4 %}<span title="<4 seeders">🔴</span>{% elif small_file.scrape_metadata.scrape.seeders < 11 %}<span title="4–10 seeders">🟡</span>{% else %}<span title=">10 seeders">🟢</span>{% endif %}</span> {{ small_file.scrape_metadata.scrape.seeders }}&nbsp;seed / {{ small_file.scrape_metadata.scrape.leechers }}&nbsp;leech <span class="max-md:hidden text-xs text-gray-500 whitespace-nowrap" title="{{ small_file.scrape_created | datetimeformat(format='long') }}">{{ small_file.scrape_created_delta | timedeltaformat(add_direction=True) }}</span>{% endif %}</td>
            </tr>
          {% endfor %}
        {% endfor %}
      </table>
    </div>
  </div>
{% endblock %}
