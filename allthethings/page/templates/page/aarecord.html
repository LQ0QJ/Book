{% extends "layouts/index.html" %}

{% block title %}{{aarecord.additional.top_box.meta_information[0]}}{% endblock %}

{% block meta_tags %}
  <meta name="description" content="{{aarecord.additional.top_box.meta_information[1:4] | join('\n\n')}}" />
{% endblock %}

{% block body %}
  <div class="mb-4 p-6 overflow-hidden bg-[#0000000d] break-words rounded">
    <img class="float-right max-w-[25%] ml-4" src="{{aarecord.additional.top_box.cover_url}}" alt="" referrerpolicy="no-referrer" onerror="this.parentNode.removeChild(this)" loading="lazy" decoding="async"/>
    <div class="text-sm text-gray-500">{{aarecord.additional.top_box.top_row}}</div>
    <div class="text-3xl font-bold">{{aarecord.additional.top_box.title}} {% if aarecord.additional.top_box.title %}<a class="custom-a text-xs align-[2px] opacity-80 hover:opacity-100" href="/search?q={{ aarecord.additional.top_box.title | urlencode }}">üîç</a>{% endif %}</div>
    <div class="text-md">{{aarecord.additional.top_box.publisher_and_edition}}</div>
    <div class="italic">{{aarecord.additional.top_box.author}} {% if aarecord.additional.top_box.author %}<a class="custom-a text-xs align-[2px] opacity-80 hover:opacity-100" href="/search?q={{ aarecord.additional.top_box.author | urlencode }}">üîç</a>{% endif %}</div>
    <div class="mt-4 line-clamp-[5] js-md5-top-box-description">{% if aarecord.additional.top_box.description %}‚Äú{{aarecord.additional.top_box.description | escape | replace('\n', '<br>' | safe)}}‚Äù{% endif %}</div>
    <a href="#" class="mt-4 js-md5-top-box-description-link hidden" onclick="document.querySelector('.js-md5-top-box-description').classList.remove('line-clamp-[5]'); this.parentNode.removeChild(this); event.preventDefault(); return false;">Read more‚Ä¶</a>
    <script>
      (function() {
        const descriptionEl = document.querySelector('.js-md5-top-box-description');
        if (descriptionEl.offsetHeight < descriptionEl.scrollHeight) {
          document.querySelector('.js-md5-top-box-description-link').classList.remove('hidden');
        }
      })();
    </script>

    <div class="mt-4 text-xs flex flex-wrap js-md5-codes-tabs" role="tablist" aria-label="code tabs" aria-multiselectable="true">
      {% for code_item in aarecord.additional.codes %}
        <a class="rounded-sm flex mb-1 mr-1 pr-1 border border-[#aaa] opacity-60 hover:opacity-80 aria-selected:opacity-100 custom-a js-md5-codes-tabs-tab" href="#" aria-selected="false" id="md5-codes-tab-{{ loop.index }}" aria-controls="md5-codes-panel-{{ loop.index }}" tabindex="0"><span class="py-[2px] bg-[#aaa] mr-1 px-1">{{ code_item.info.label or code_item.key }}</span><span class="py-[2px]">{{ code_item.masked_isbn or code_item.value }}</span></a>
      {% endfor %}
    </div>
    <div>
      {% for code_item in aarecord.additional.codes %}
        <div id="md5-codes-panel-{{ loop.index }}" role="tabpanel" aria-labelledby="md5-codes-tab-{{ loop.index }}" hidden class="text-sm mt-2">
          <div><strong>{{ code_item.info.label or code_item.key }}:</strong> {{ code_item.masked_isbn or code_item.value }}</div>
          {% if code_item.info.description %}<div class="">{{ code_item.info.description }}</div>{% endif %}
          {% if code_item.info.url %}<div class="">URL: <a href="{{ code_item.info.url | replace('%s', code_item.value) }}" rel="noopener noreferrer nofollow">{{ code_item.info.url | replace('%s', code_item.value) }}</a></div>{% endif %}
          {% if code_item.info.website %}<div class="">Website: <a href="{{ code_item.info.website }}" rel="noopener noreferrer nofollow">{{ code_item.info.website }}</a></div>{% endif %}
          <div>AA: <a href="/search?q={{ code_item.value | urlencode }}">Search Anna‚Äôs Archive for ‚Äú{{ code_item.value }}‚Äù</a></div>
        </div>
      {% endfor %}
    </div>
    <script>
      (function() {
        const tabEls = document.querySelectorAll('.js-md5-codes-tabs-tab');
        for (const el of tabEls) {
          el.addEventListener('tabOpen', () => {
            for (otherEl of tabEls) {
              if (otherEl != el && otherEl.getAttribute('aria-selected') === "true") {
                document.querySelector('.js-md5-codes-tabs').ariaTablist.close(otherEl);
              }
            }
          })
        }
      })();
    </script>
  </div>

  <div class="flex flex-wrap mb-1 text-[#000000a3]" role="tablist" aria-label="file tabs">
    <button class="mr-4 mb-1 border-b-[3px] border-transparent aria-selected:border-[#0095ff] aria-selected:text-black aria-selected:font-bold js-md5-tab-downloads" aria-selected="true" id="md5-tab-downloads" aria-controls="md5-panel-downloads" tabindex="0">{% if aarecord_id_split[0] == 'md5' %}Downloads{% elif aarecord_id_split[0] == 'ia' %}Borrow{% endif %} ({{ (aarecord.additional.fast_partner_urls | length) + (aarecord.additional.download_urls | length) }})</button>
    {% if aarecord_id_split[0] == 'md5' %}
      <button class="mr-4 mb-1 border-b-[3px] border-transparent aria-selected:border-[#0095ff] aria-selected:text-black aria-selected:font-bold js-md5-tab-discussion" aria-selected="false" id="md5-tab-discussion" aria-controls="md5-panel-discussion" tabindex="0">Discussion (‚Äì)</button>
      <button class="mr-4 mb-1 border-b-[3px] border-transparent aria-selected:border-[#0095ff] aria-selected:text-black aria-selected:font-bold js-md5-tab-lists" aria-selected="false" id="md5-tab-lists" aria-controls="md5-panel-lists" tabindex="0">Lists (‚Äì)</button>
      <button class="mr-4 mb-1 border-b-[3px] border-transparent aria-selected:border-[#0095ff] aria-selected:text-black aria-selected:font-bold js-md5-tab-stats" aria-selected="false" id="md5-tab-stats" aria-controls="md5-panel-stats" tabindex="0">Stats (‚Äì)</button>
    {% endif %}
    <button class="mr-4 mb-1 border-b-[3px] border-transparent aria-selected:border-[#0095ff] aria-selected:text-black aria-selected:font-bold" aria-selected="false" id="md5-tab-details" aria-controls="md5-panel-details" tabindex="0">{{ gettext('common.tech_details') }}</button>
  </div>

  {% if aarecord_id_split[0] == 'md5' %}
    <script>
      (function() {
        const md5 = {{ aarecord_id_split[1] | tojson }};

        function fetchComments() {
          fetch("/dyn/md5_reports/" + md5).then((response) => response.ok ? response.text() : 'Error 827151').then((text) => {
            const reloadNode = document.querySelector(".js-md5-issues-reports");
            reloadNode.innerHTML = text;
            window.executeScriptElements(reloadNode);
          });
        }

        window.md5ReloadSummary = function() {
          fetch("/dyn/md5/summary/" + md5).then((response) => response.json()).then((json) => {
            document.querySelector(".js-md5-tab-discussion").innerText = 'Discussion (' + (json.comments_count + json.reports_count + json.great_quality_count) + ')';
            document.querySelector(".js-md5-tab-lists").innerText = 'Lists (' + json.lists_count + ')';
            document.querySelector(".js-md5-tab-stats").innerText = 'Stats (' + json.downloads_total + ')';
            document.querySelector(".js-md5-button-new-issue-label").innerText = 'Report file issue (' + json.reports_count + ')';
            document.querySelector(".js-md5-button-great-quality-label").innerText = 'Great file quality (' + json.great_quality_count + ')';
            document.querySelector(".js-md5-button-new-comment").innerText = 'Add comment (' + json.comments_count + ')';
            window.md5UserReaction = json.user_reaction;
            document.querySelector(".js-md5-button-great-quality").classList.toggle("selected", window.md5UserReaction === 2);
            document.querySelector(".js-md5-button-new-comment").classList.toggle("disabled", window.md5UserReaction !== 2);
            if (window.md5UserReaction !== 2) {
              document.querySelector('.js-new-comment').classList.toggle('hidden', true);
            }

            if (json.comments_count > 0 || json.reports_count > 0) {
              document.getElementById('md5-panel-discussion').addEventListener("panelOpen", fetchComments);
              fetchComments();
            } else {
              document.querySelector(".js-md5-issues-reports").classList.add("hidden");
            }

            if (json.is_member) {
              document.querySelector('.js-fast-download-no-member-header').classList.add('hidden');
              document.querySelector('.js-fast-download-links-disabled').classList.add('hidden');
              document.querySelector('.js-fast-download-links-enabled').classList.remove('hidden');
              if (json.download_still_active) {
                document.querySelector('.js-fast-download-member-header-valid-for').classList.remove('hidden');
              } else {
                if (json.downloads_left) {
                  const elRemaining = document.querySelector('.js-fast-download-member-header-remaining');
                  elRemaining.classList.remove('hidden');
                  elRemaining.innerHTML = elRemaining.innerHTML.replace('XXXXXX', json.downloads_left);
                  for (const el of document.querySelectorAll('.js-fast-download-links-enabled .js-download-link')) {
                    el.addEventListener("click", function() {
                      elRemaining.classList.add('hidden');
                      document.querySelector('.js-fast-download-member-header-valid-for').classList.remove('hidden');
                    });
                  }
                } else {
                  document.querySelector('.js-fast-download-member-header-no-remaining').classList.remove('hidden');
                }
              }
            }
          });
        };

        document.addEventListener("DOMContentLoaded", window.md5ReloadSummary);
      })();
    </script>
  {% endif %}

  <div id="md5-panel-downloads" role="tabpanel" tabindex="0" aria-labelledby="md5-tab-downloads">
    {% if (aarecord.file_unified_data.problems | length) > 0 %}
      <div>{{ gettext('page.md5.box.issues.text1') }}</div>
      <ul class="list-inside mb-4">
        {% for problem in aarecord.file_unified_data.problems %}
          <li>- {{ md5_problem_type_mapping[problem.type] }}{% if problem.descr %} ("{{problem.descr}}"){% endif %}</li>
          {% if problem.better_md5 %}
            <li>- A better version of this file might be available at <a href="/md5/{{ problem.better_md5 | lower | urlencode }}">/md5/{{ problem.better_md5 | lower }}</a></li>
          {% endif %}
        {% endfor %}
      </ul>

      <div class="mb-4">{{ gettext('page.md5.box.issues.text2') }}</div>
    {% endif %}

    {% if (aarecord.additional.fast_partner_urls | length) > 0 %}
      <div class="mb-4">
        <div class="js-fast-download-no-member-header">{{ gettext('page.md5.box.download.header_fast_no_member', a_membership=('href="/donate"' | safe)) }}</div>
        <div class="hidden js-fast-download-member-header-remaining">{{ gettext('page.md5.box.download.header_fast_member', remaining='XXXXXX') }}</div>
        <div class="hidden js-fast-download-member-header-no-remaining">{{ gettext('page.md5.box.download.header_fast_member_no_remaining', a_membership=('href="/donate" target="_blank"' | safe)) }}</div>
        <div class="hidden js-fast-download-member-header-valid-for">{{ gettext('page.md5.box.download.header_fast_member_valid_for') }}</div>

        <ul class="mb-4 js-fast-download-links-disabled">
          {% for label, url, extra in aarecord.additional.fast_partner_urls %}
            <li>- {{ gettext('page.md5.box.download.option', num=loop.index, link=label, extra='') }}</li>
          {% endfor %}
        </ul>
        <ul class="mb-4 hidden js-fast-download-links-enabled">
          {% for label, url, extra in aarecord.additional.fast_partner_urls %}
            <li>- {{ gettext('page.md5.box.download.option', num=loop.index, link=(('<a href="' + url + '" rel="noopener noreferrer nofollow" class="js-download-link">' + label + '</a>') | safe), extra=(extra | safe)) }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <div>
      {% if aarecord_id_split[0] == 'md5' %}
        {% if (aarecord.additional.fast_partner_urls | length) > 0 %}
          <div class="font-bold">{{ gettext('page.md5.box.download.header_slow') }}</div>
        {% else %}
          <div class="font-bold">{{ gettext('page.md5.box.download.header_generic') }}</div>
        {% endif %}
      {% endif %}

      {% if (aarecord.additional.download_urls | length) > 0 %}
        <ul class="mb-4">
          {% for label, url, extra in aarecord.additional.download_urls %}
            <li>- {{ gettext('page.md5.box.download.option', num=loop.index, link=(('<a href="' + url + '" rel="noopener noreferrer nofollow" {% if not url.startswith("/") }target="_blank"{% endif %} class="js-download-link">' + label + '</a>') | safe), extra=(extra | safe)) }}</li>
          {% endfor %}
        </ul>
        {% if (aarecord.file_unified_data.problems | length) == 0 %}
          <div class="mb-4">{{ gettext('page.md5.box.download.no_issues_notice') }}</div>
        {% endif %}

        <script>
          (function() {
            const md5 = {{ aarecord_id_split[1] | tojson }};
            for (const el of document.querySelectorAll(".js-download-link")) {
              // Increase counter when clicked.
              el.addEventListener("click", function() {
                try {
                  if (window.localStorage['md5_download_counted_' + md5] === "1") {
                    return;
                  }
                  window.localStorage['md5_download_counted_' + md5] = "1";
                } catch(e) {
                  console.error("Error with localStorage: ", e);
                }
                navigator.sendBeacon("/dyn/downloads/increment/" + md5);
              });
            }
          })();
        </script>
      {% else %}
        <p>{{ gettext('page.md5.box.download.no_found') }}</p>
      {% endif %}
    </div>
  </div>

  {% if aarecord_id_split[0] == 'md5' %}
    <div id="md5-panel-discussion" role="tabpanel" tabindex="0" aria-labelledby="md5-tab-discussion" hidden>
      {% if gettext('common.english_only') != 'Text below continues in English.' %}
        <p class="mb-4 font-bold">{{ gettext('common.english_only') }}</p>
      {% endif %}

      <div lang="en">
        <p class="mb-4">
          Help out the community by reporting the quality of this file! üôå
        </p>

        <div class="">
          <button class="custom bg-[#777] hover:bg-[#999] text-white font-bold py-1 px-3 rounded shadow mb-2" onclick='if (localStorage["aa_logged_in"] !== "1") { document.querySelector(".js-discussion-logged-out").classList.toggle("hidden"); return; }; document.querySelector(".js-report-file-issues").classList.toggle("hidden"); document.querySelector(".js-new-comment").classList.add("hidden"); document.querySelector(".js-add-to-list").classList.add("hidden")'><span class='text-[18px] align-text-bottom text-white inline-block icon-[uil--exclamation-triangle]'></span> <span class="js-md5-button-new-issue-label">Report file issue (0)</span></button>
          
          <span class="inline-block mb-2"><button class="shadow js-md5-button-great-quality custom bg-[#777] hover:bg-[#999] text-white font-bold py-1 px-3 rounded-l border-r border-[#999] align-bottom [&.selected]:bg-[#555] [&.selected]:pt-[5px] [&.selected]:pb-[3px] [&.selected]:shadow-[inset_0px_-1px_0px_0px_rgba(255,255,255,0.2),_inset_0px_1px_5px_0px_rgba(0,0,0,0.6)]" onclick='if (localStorage["aa_logged_in"] !== "1") { document.querySelector(".js-discussion-logged-out").classList.toggle("hidden"); return; }; fetch("/dyn/reactions/" + (window.md5UserReaction === 2 ? 0 : 2) + "/md5:" + {{ aarecord_id_split[1] | tojson }}, { method: "PUT" }).then(() => window.md5ReloadSummary())'><span class='text-[21px] align-[-4px] text-white inline-block icon-[material-symbols--star-outline] [button.selected>&]:icon-[material-symbols--star]'></span> <span class="js-md5-button-great-quality-label">Great file quality (0)</span></button><button class="disabled shadow js-md5-button-new-comment custom bg-[#777] hover:bg-[#999] [&.disabled]:opacity-40 [&.disabled]:hover:bg-[#777] [&.disabled]:cursor-auto text-white font-bold py-1 px-3 rounded-r" onclick='if (this.classList.contains("disabled")) { return; }; document.querySelector(".js-new-comment").classList.toggle("hidden"); document.querySelector(".js-report-file-issues").classList.add("hidden"); document.querySelector(".js-add-to-list").classList.add("hidden")'>Add comment (0)</button></span>
        </div>

        <div class="js-discussion-logged-out hidden">Please <a href="/login">log in</a>.</div>

        <form class="js-report-file-issues hidden mb-6" onsubmit='window.submitForm(event, "/dyn/md5_report/" + {{ aarecord_id_split[1] | tojson }})'>
          <fieldset>
            <p class="mb-2">
              What is wrong with this file?
            </p>
            <select name="type" class="bg-[#00000011] px-2 py-1 rounded mb-4 w-[100%] max-w-[400px]" oninput="for (el of document.querySelectorAll('.js-report-file-issues-submenu')) { el.classList.add('hidden'); } document.querySelector('.js-report-file-issues-submenu-' + this.value).classList.remove('hidden')">
              <option></option>
              {% for type in md5_report_type_mapping %}
                <option value="{{ type }}">{{ md5_report_type_mapping[type] }}</option>
              {% endfor %}
            </select>

            <div class="hidden mb-4 js-report-file-issues-submenu js-report-file-issues-submenu-copyright">
              <p class="">
                Please use the <a href="/copyright">DMCA / Copyright claim form</a>.
              </p>
            </div>

            <div class="hidden mb-4 js-report-file-issues-submenu js-report-file-issues-submenu-metadata">
              <p class="mb-4">
                Please report metadata errors at the source library. If there are multiple source libraries, know that we pull metadata from top to bottom, so the first one might be sufficient.
              </p>

              {% if aarecord.lgrsnf_book %}
                - <strong>Libgen.rs Non-Fiction:</strong> Reply to <a href="https://forum.mhut.org/viewtopic.php?t=6423" target="_blank">this forum thread</a> and mention the following URL:<br>
                <a href="http://library.lol/main/{{aarecord['lgrsnf_book']['md5'].lower()}}" target="_blank">http://library.lol/main/{{aarecord['lgrsnf_book']['md5'].lower()}}</a><br>
              {% endif %}
              {% if aarecord.lgrsfic_book %}
                - <strong>Libgen.rs Fiction:</strong> Reply to <a href="https://forum.mhut.org/viewtopic.php?t=6423" target="_blank">this forum thread</a> and mention the following URL:<br>
                <a href="http://library.lol/fiction/{{aarecord['lgrsfic_book']['md5'].lower()}}" target="_blank">http://library.lol/fiction/{{aarecord['lgrsfic_book']['md5'].lower()}}</a><br>
              {% endif %}
              {% if aarecord.lgli_file %}
                - <strong>Libgen.li:</strong> Go to <a href="https://libgen.li/file.php?md5={{aarecord['lgli_file']['md5'].lower()}}" target="_blank">this page</a> and click ‚ÄúReport an error‚Äù. Alternatively, create a new post in <a href="https://libgen.li/community/viewforum.php?f=2" target="_blank">this forum thread</a>.<br>
              {% endif %}
              {% if aarecord.zlib_book %}
                - <strong>Z-Library:</strong> Go to <a href="https://libgen.li/file.php?md5=http://zlibrary24tuxziyiyfr7zd46ytefdqbqd2axkmxm4o5374ptpc52fad.onion/md5/{{aarecord['zlib_book']['md5_reported'].lower()}}" target="_blank">this page</a> (requires TOR browser), and click on ‚ÄúSomething wrong?‚Äù => ‚ÄúSuggest correction‚Äù.<br>
              {% endif %}
            </div>

            <div class="hidden mb-4 js-report-file-issues-submenu js-report-file-issues-submenu-download js-report-file-issues-submenu-broken js-report-file-issues-submenu-pages js-report-file-issues-submenu-spam js-report-file-issues-submenu-other">
              <p class="mb-1">
                Describe the issue (required)
              </p>
              <textarea required name="content" class="grow bg-[#00000011] px-2 py-1 mb-4 rounded w-[100%] h-[120px]" placeholder="Issue description"></textarea>
              <p class="mb-2">
                MD5 of a better version of this file (if applicable). Fill this in if there is another file that closely matches this file (same edition, same file extension if you can find one), which people should use instead of this file. If you know of a better version of this file outside of Anna‚Äôs Archive, then please <a href="/account/upload" target="_blank">upload it</a>.
              </p>
              <p class="mb-1">
                You can get the md5 from the URL, e.g.<br>https://annas-archive.org/md5/<strong>{{ aarecord_id_split[1] }}</strong>
              </p>
              <input type="text" name="better_md5" class="grow bg-[#00000011] px-2 py-1 mb-4 rounded w-[100%]" placeholder="{{ aarecord_id_split[1] }}" minlength="32" maxlength="32" />
              <div class="">
                <button type="submit" class="mr-2 bg-[#777] hover:bg-[#999] text-white font-bold py-1 px-3 rounded shadow">Submit report</button>
                <span class="js-spinner invisible mb-[-3px] text-xl text-[#555] inline-block icon-[svg-spinners--ring-resize]"></span>
              </div>
            </div>
          </fieldset>
          <div class="hidden js-success">‚úÖ Thank you for submitting your report. It will be shown on this page, as well as reviewed manually by Anna (until we have a proper moderation system).</div>
          <div class="hidden js-failure mb-4">‚ùå Something went wrong. Please reload the page and try again.</div>
        </form>

        <form class="js-new-comment hidden mb-4" onsubmit='window.submitForm(event, "/dyn/comments/md5:" + {{ aarecord_id_split[1] | tojson }})'>
          <fieldset>
            <p class="mb-1">
              If this file has great quality, you can discuss anything about it here! If not, please use the ‚ÄúReport file issue‚Äù button.
            </p>
            <textarea required name="content" class="grow bg-[#00000011] px-2 py-1 mb-1 rounded w-[100%] h-[80px]" placeholder="I loved this book!"></textarea>
            <div class="">
              <button type="submit" class="mr-2 bg-[#777] hover:bg-[#999] text-white font-bold py-1 px-3 rounded shadow">Leave comment</button>
              <span class="js-spinner invisible mb-[-3px] text-xl text-[#555] inline-block icon-[svg-spinners--ring-resize]"></span>
            </div>
          </fieldset>
          <div class="hidden js-success">‚úÖ You left a comment. It might take a minute for it to show up.</div>
          <div class="hidden js-failure mb-4">‚ùå Something went wrong. Please reload the page and try again.</div>
        </form>

        <div class="js-md5-issues-reports mt-4"><span class="mb-[-3px] text-xl text-[#555] inline-block icon-[svg-spinners--ring-resize]"></span></div>
      </div>
    </div>

    <div id="md5-panel-lists" role="tabpanel" tabindex="0" aria-labelledby="md5-tab-lists" hidden>
      {% if gettext('common.english_only') != 'Text below continues in English.' %}
        <p class="mb-4 font-bold">{{ gettext('common.english_only') }}</p>
      {% endif %}

      <div lang="en">
        <script>
          document.getElementById('md5-panel-lists').addEventListener("panelOpen", () => {
            const md5 = {{ aarecord_id_split[1] | tojson }};
            fetch("/dyn/lists/md5:" + md5).then((response) => response.ok ? response.text() : 'Error 921857').then((text) => {
              const reloadNode = document.querySelector(".js-md5-lists-wrapper");
              reloadNode.innerHTML = text;
              window.executeScriptElements(reloadNode);
            });
          });
        </script>
        <div class="js-md5-lists-wrapper"><span class="mb-[-3px] text-xl text-[#555] inline-block icon-[svg-spinners--ring-resize]"></span></div>
      </div>
    </div>

    <div id="md5-panel-stats" role="tabpanel" tabindex="0" aria-labelledby="md5-tab-stats" hidden>
      {% if gettext('common.english_only') != 'Text below continues in English.' %}
        <p class="mb-4 font-bold">{{ gettext('common.english_only') }}</p>
      {% endif %}

      <div lang="en">
        <p class="mb-4">
          Total downloads: <span class="js-md5-stats-total-downloads"><span class="mb-[-3px] text-xl text-[#555] inline-block icon-[svg-spinners--ring-resize]"></span></span><br>
          <div class="js-md5-stats-downloads-chart h-[200px]"></div>
        </p>
        <script>
          document.getElementById('md5-panel-stats').addEventListener("panelOpen", () => {
            const md5 = {{ aarecord_id_split[1] | tojson }};
            fetch("/dyn/downloads/stats/" + md5).then((response) => response.json()).then((json) => {
              document.querySelector(".js-md5-stats-total-downloads").innerText = json.total;
              Plotly.newPlot(document.querySelector(".js-md5-stats-downloads-chart"), [{
                type: "bar",
                x: json.timeseries_x.map((t) => new Date(t * 3600000)),
                y: json.timeseries_y,
                line: {color: '#0095ff'}
              }], {
                margin: {
                  l: 40,
                  r: 16,
                  b: 50,
                  t: 8,
                  pad: 0
                }
              }, {staticPlot: true});
            });
          });
        </script>
      </div>
    </div>
  {% endif %}

  <div id="md5-panel-details" role="tabpanel" tabindex="0" aria-labelledby="md5-tab-details" hidden>
    {% if aarecord_id_split[0] == 'md5' %}
      <p class="mb-4">
        A "file MD5" is a hash that gets computed from the file contents, and is reasonably unique based on that content. All shadow libraries that we have indexed on here primarily use MD5s to identify files.
      </p>

      <p class="mb-4">
        A file might appear in multiple shadow libraries. For information about the various datasets that we have compiled, see the <a href="/datasets">Datasets page</a>.
      </p>
    {% elif aarecord_id_split[0] == 'ia' %}
      <p class="mb-4">
        This is a file managed by the <a href="https://archive.org/details/inlibrary">Internet Archive‚Äôs Digital Lending Library</a>, and indexed by Anna‚Äôs Archive for search. For information about the various datasets that we have compiled, see the <a href="/datasets">Datasets page</a>.
      </p>
    {% endif %}

    <p class="mb-4">
      For information about this particular file, check out its <a href="/db/aarecord/{{ aarecord_id }}.json">JSON file</a>.
    </p>
  </div>
{% endblock %}
